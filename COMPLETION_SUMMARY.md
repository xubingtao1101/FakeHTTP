# âœ… -C åŠŸèƒ½é‡æ„å®Œæˆæ€»ç»“

## ğŸ¯ å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒåŠŸèƒ½å®ç°
- âœ… å°† `-C` é€‰é¡¹ä» "TLS client hello" æ”¹ä¸º "åŸºäºé…ç½®æ–‡ä»¶ç”Ÿæˆ HTTP payload"
- âœ… å®ç°é…ç½®æ–‡ä»¶è§£æå™¨ï¼ˆINI æ ¼å¼ï¼‰
- âœ… æ”¯æŒ methodsã€URIsã€headersã€body çš„çµæ´»é…ç½®
- âœ… æ”¯æŒåŒä¸€ header çš„å¤šä¸ªå€¼è½®æµä½¿ç”¨
- âœ… è‡ªåŠ¨æ ¹æ® HTTP æ–¹æ³•å†³å®šæ˜¯å¦æ·»åŠ  body
- âœ… è‡ªåŠ¨è®¡ç®— Content-Length

### 2. é™åˆ¶æ‰©å¤§ï¼ˆ3å€ï¼‰
- âœ… MAX_METHODS: 10 â†’ 30
- âœ… MAX_URIS: 100 â†’ 300
- âœ… MAX_HEADERS: 50 â†’ 150
- âœ… MAX_HEADER_VALUES: 20 â†’ 60
- âœ… MAX_LINE_LENGTH: 4KB â†’ 12KB
- âœ… MAX_BODY_SIZE: 8KB â†’ 24KB
- âœ… BUFFLEN (payload): 2KB â†’ 6KB

### 3. OOM ä¿æŠ¤æœºåˆ¶
- âœ… æ·»åŠ æœ€å¤§ payload æ•°é‡é™åˆ¶ï¼ˆ100,000 ä¸ªï¼‰
- âœ… å¯åŠ¨å‰æ£€æŸ¥å¹¶æ‹’ç»è¿‡å¤§çš„é…ç½®
- âœ… æ˜¾ç¤ºé¢„è®¡å†…å­˜å ç”¨
- âœ… æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

### 4. æ–‡æ¡£å®Œå–„
- âœ… CONFIG_C_USAGE.md - è¯¦ç»†ä½¿ç”¨è¯´æ˜
- âœ… REFACTOR_SUMMARY.md - é‡æ„æ€»ç»“
- âœ… LIMITS_UPDATE.md - é™åˆ¶å‚æ•°è¯´æ˜
- âœ… OOM_PROTECTION.md - OOM é˜²æŠ¤æŒ‡å—
- âœ… QUICK_REFERENCE.txt - å¿«é€Ÿå‚è€ƒå¡ç‰‡
- âœ… é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆ3ä¸ªï¼‰

### 5. ä»£ç è´¨é‡
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… å†…å­˜å®‰å…¨ï¼ˆé˜²æ­¢æ³„æ¼ï¼‰
- âœ… è¾“å…¥éªŒè¯
- âœ… æ¸…æ™°çš„æ—¥å¿—è¾“å‡º
- âœ… ç¼–è¯‘é€šè¿‡ï¼Œæ— è­¦å‘Š

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

### æ–°å¢æ–‡ä»¶ï¼ˆ10ä¸ªï¼‰
1. `src/config_parser.c` - é…ç½®è§£æå™¨å®ç°
2. `include/config_parser.h` - é…ç½®è§£æå™¨å¤´æ–‡ä»¶
3. `CONFIG_C_USAGE.md` - ä½¿ç”¨è¯´æ˜
4. `REFACTOR_SUMMARY.md` - é‡æ„æ€»ç»“
5. `LIMITS_UPDATE.md` - é™åˆ¶è¯´æ˜
6. `OOM_PROTECTION.md` - OOM é˜²æŠ¤
7. `QUICK_REFERENCE.txt` - å¿«é€Ÿå‚è€ƒ
8. `config_example.conf` - åŸºç¡€ç¤ºä¾‹
9. `test_config.conf` - æµ‹è¯•ç¤ºä¾‹
10. `advanced_config.conf` - é«˜çº§ç¤ºä¾‹

### ä¿®æ”¹æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰
1. `include/payload.h` - æ›´æ–° payload ç±»å‹
2. `src/payload.c` - æ·»åŠ é…ç½®æ–‡ä»¶å¤„ç†é€»è¾‘
3. `src/mainfun.c` - æ›´æ–°å‘½ä»¤è¡Œå‚æ•°å¤„ç†

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ç”¨æ³•
```bash
sudo ./build/fakehttp -i eth0 -C config_example.conf
```

### é…ç½®æ–‡ä»¶æ ¼å¼
```ini
[methods]
GET
POST

[uris]
/api/test
/data/query

[headers]
Host: example.com
User-Agent: Mozilla/5.0
Accept: application/json

[body]
{"test":"data"}
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. Payload æ•°é‡è®¡ç®—
**æ€»æ•° = methods Ã— URIs Ã— (æ¯ä¸ªheaderçš„å€¼æ•°é‡çš„ä¹˜ç§¯)**

ç¤ºä¾‹ï¼š
- 2 methods Ã— 2 URIs Ã— 2 hosts Ã— 2 UAs = **16 ä¸ª payload** âœ…
- 5 methods Ã— 20 URIs Ã— 5 hosts Ã— 5 UAs Ã— 5 accepts = **12,500 ä¸ª** âš ï¸
- 10 methods Ã— 50 URIs Ã— 10 hosts Ã— 10 UAs = **500,000 ä¸ª** âŒ ä¼šè¢«æ‹’ç»

### 2. å†…å­˜å ç”¨
- æ¯ä¸ª payload â‰ˆ 6 KB
- 100 ä¸ª â‰ˆ 600 KB
- 1,000 ä¸ª â‰ˆ 6 MB
- 10,000 ä¸ª â‰ˆ 60 MB
- 100,000 ä¸ª â‰ˆ 600 MBï¼ˆæœ€å¤§é™åˆ¶ï¼‰

### 3. æ¨èé…ç½®è§„æ¨¡
- **æµ‹è¯•ç¯å¢ƒ**ï¼š50-500 ä¸ª payload
- **ç”Ÿäº§ç¯å¢ƒ**ï¼š500-5,000 ä¸ª payload
- **é«˜çº§åœºæ™¯**ï¼š5,000-50,000 ä¸ª payload
- **å±é™©åŒºåŸŸ**ï¼š> 100,000 ä¸ªï¼ˆä¼šè¢«æ‹’ç»ï¼‰

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•
```bash
# ä½¿ç”¨å°é…ç½®æµ‹è¯•
sudo ./build/fakehttp -i lo -C test_config.conf

# æ£€æŸ¥æ—¥å¿—è¾“å‡º
# åº”è¯¥çœ‹åˆ°ï¼šGenerating 16 payloads from config file (approx 0.1 MB memory)
```

### 2. è¾¹ç•Œæµ‹è¯•
```bash
# æµ‹è¯•ä¸å­˜åœ¨çš„æ–‡ä»¶
sudo ./build/fakehttp -i lo -C nonexistent.conf

# æµ‹è¯•æ ¼å¼é”™è¯¯çš„é…ç½®
# åˆ›å»ºä¸€ä¸ªç¼ºå°‘ Host header çš„é…ç½®æ–‡ä»¶

# æµ‹è¯•å¤šæ¬¡ä½¿ç”¨ -C
sudo ./build/fakehttp -i lo -C test1.conf -C test2.conf
```

### 3. OOM ä¿æŠ¤æµ‹è¯•
åˆ›å»ºä¸€ä¸ªä¼šç”Ÿæˆå¤§é‡ payload çš„é…ç½®ï¼ŒéªŒè¯æ˜¯å¦è¢«æ­£ç¡®æ‹’ç»ã€‚

## ğŸ“Š æ€§èƒ½æ•°æ®

| Payload æ•°é‡ | å†…å­˜å ç”¨ | å¯åŠ¨æ—¶é—´ï¼ˆä¼°è®¡ï¼‰ |
|-------------|---------|----------------|
| 100 | 600 KB | < 1ç§’ |
| 1,000 | 6 MB | < 1ç§’ |
| 10,000 | 60 MB | 1-2ç§’ |
| 50,000 | 300 MB | 5-10ç§’ |
| 100,000 | 600 MB | 10-20ç§’ |

## ğŸ› å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ï¼šOOM Killed
**åŸå› **ï¼šé…ç½®æ–‡ä»¶ç”Ÿæˆäº†è¿‡å¤šçš„ payload

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å‡å°‘ header çš„å€¼æ•°é‡ï¼ˆå½±å“æœ€å¤§ï¼‰
2. å‡å°‘ methods å’Œ URIs çš„æ•°é‡
3. åˆ†æ‰¹åˆ›å»ºå¤šä¸ªé…ç½®æ–‡ä»¶
4. æ£€æŸ¥é…ç½®å‰å…ˆè®¡ç®— payload æ•°é‡

### é—®é¢˜ï¼šå¯åŠ¨å¾ˆæ…¢
**åŸå› **ï¼šç”Ÿæˆå’Œæ‰“ä¹±å¤§é‡ payload éœ€è¦æ—¶é—´

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å‡å°‘ payload æ•°é‡
2. è€å¿ƒç­‰å¾…ï¼ˆ100,000 ä¸ªçº¦éœ€ 10-20 ç§’ï¼‰

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

1. **å»¶è¿Ÿç”Ÿæˆ**ï¼šæŒ‰éœ€ç”Ÿæˆ payload è€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨ç”Ÿæˆ
2. **å‹ç¼©å­˜å‚¨**ï¼šå¯¹ç›¸ä¼¼çš„ payload è¿›è¡Œå‹ç¼©
3. **æµå¼ç”Ÿæˆ**ï¼šä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼è€Œä¸æ˜¯é¢„ç”Ÿæˆ
4. **é…ç½®éªŒè¯å·¥å…·**ï¼šæä¾›ç‹¬ç«‹çš„å·¥å…·æ¥éªŒè¯é…ç½®æ–‡ä»¶
5. **JSON/YAML æ”¯æŒ**ï¼šæ”¯æŒæ›´å¤šé…ç½®æ–‡ä»¶æ ¼å¼

## âœ… éªŒè¯æ¸…å•

- [x] ä»£ç ç¼–è¯‘é€šè¿‡
- [x] åŸºç¡€åŠŸèƒ½æ­£å¸¸
- [x] OOM ä¿æŠ¤ç”Ÿæ•ˆ
- [x] é”™è¯¯å¤„ç†å®Œå–„
- [x] æ–‡æ¡£é½å…¨
- [x] ç¤ºä¾‹é…ç½®å¯ç”¨
- [x] å†…å­˜é™åˆ¶åˆç†
- [x] æ—¥å¿—è¾“å‡ºæ¸…æ™°

## ğŸ“ ä½¿ç”¨æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
2. æ˜¯å¦åŒ…å«å¿…éœ€çš„ Host header
3. Payload æ•°é‡æ˜¯å¦è¶…å‡ºé™åˆ¶
4. æŸ¥çœ‹ç¨‹åºè¾“å‡ºçš„é”™è¯¯ä¿¡æ¯

è¯¦ç»†æ–‡æ¡£ï¼š
- ä½¿ç”¨è¯´æ˜ï¼š`CONFIG_C_USAGE.md`
- OOM é˜²æŠ¤ï¼š`OOM_PROTECTION.md`
- å¿«é€Ÿå‚è€ƒï¼š`QUICK_REFERENCE.txt`

---

**é‡æ„å®Œæˆæ—¶é—´**ï¼š2026å¹´2æœˆ8æ—¥  
**ç‰ˆæœ¬**ï¼šv1.0  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå¹¶æµ‹è¯•

